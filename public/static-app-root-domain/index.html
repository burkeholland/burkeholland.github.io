<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>How to configure a root domain in an Azure Static Web App - Burke Knows Words</title>
    
    <meta name="description" content="Azure Static Web Apps is a new Azure service for hosting static web applications. Azure is very literal when they name things. Want Storage? You need Azure Storage. Want a Serverless function? Azure Functions. Need to host a static web app? AZURE STATIC WEB APPS.
Static Web Apps is currently in preview, which means not all features that need to be there are quite there yet. One of the features that is currently AFK is support for root domains.">
    <meta name="author" content="">
    
    <link href="http://burkeholland.github.io/an-old-hope.min.css" rel="stylesheet">
    <link href="http://burkeholland.github.io/style.css" rel="stylesheet">
    <link href="http://burkeholland.github.io/custom.css" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="http://burkeholland.github.io/apple-touch-icon.png">
    <link rel="icon" href="http://burkeholland.github.io/favicon.ico">
    <meta name="generator" content="Hugo 0.80.0" />
    
    
    
    <script>
      function setTheme() {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.body.classList.add('dark');
          return;
        }

        const time = new Date();
        const prev = localStorage.getItem('date');
        const date = String(time.getMonth() + 1) + '.' + String(time.getDate());

        const now = time.getTime();
        let sunrise;
        let sunset;

        function setBodyClass() {
          if (now > sunrise && now < sunset) return;
          document.body.classList.add('dark');
        }

        if (date !== prev) {
          fetch('https://api.ipgeolocation.io/astronomy?apiKey=5ed37d85103e4defa5df4c5298ed5215')
            .then((res) => res.json())
            .then((data) => {
              sunrise = data.sunrise.split(':').map(Number);
              sunset = data.sunset.split(':').map(Number);
            })
            .catch(() => {
              sunrise = [7, 0];
              sunset = [19, 0];
            })
            .finally(() => {
              sunrise = time.setHours(sunrise[0], sunrise[1], 0);
              sunset = time.setHours(sunset[0], sunset[1], 0);
              setBodyClass();
              localStorage.setItem('sunrise', sunrise);
              localStorage.setItem('sunset', sunset);
            });
          localStorage.setItem('date', date);
        } else {
          sunrise = Number(localStorage.getItem('sunrise'));
          sunset = Number(localStorage.getItem('sunset'));
          setBodyClass();
        }
      }
    </script>
  </head>
  <body class="single">
    <script>
      setTheme();
    </script>
    <header class="header">
      <nav class="nav">
        <p class="logo"><a href="http://burkeholland.github.io/">Burke Knows Words</a></p>
      </nav>
    </header>
    <main class="main">


<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">How to configure a root domain in an Azure Static Web App</h1>
    <div class="post-meta">May 6, 2020</div>
  </header>
  <div class="post-content"><p><a href="https://docs.microsoft.com/en-us/azure/static-web-apps/?WT.mc_id=staticwebapps-docs-cxa">Azure Static Web Apps</a> is a new Azure service for hosting static web applications. Azure is very literal when they name things. Want Storage? You need Azure Storage. Want a Serverless function? Azure Functions. Need to host a static web app? <strong>AZURE STATIC WEB APPS</strong>.</p>
<p>Static Web Apps is currently in preview, which means not all features that need to be there are quite there yet. One of the features that is currently <a href="https://www.grammarly.com/blog/afk-meaning/">AFK</a> is support for root domains. You can have <a href="https://www.mystaticsite.com">https://www.mystaticsite.com</a>, but you cannot have <a href="https://mystaticsite.com">https://mystaticsite.com</a>.</p>
<p>OR CAN YOU?</p>
<p>If you click on those links, you’ll see that they both work. While root domains aren’t officially supported in Azure Static Web Apps, you can make it work with a little bit of DNS trickery and the help of Cloudflare. In this article, I’ll show you how to get a root domain configured for your Static Web App while we’re waiting for official root domain support to arrive.</p>
<h3 id="setting-up-cloudflare">Setting up Cloudflare</h3>
<p>Cloudflare is a service that is often placed in front of web sites to provide additional features and security, such as protection against denial of service attacks. Cloudflare has a powerful DNS and page rules engine that you can use to get root domain support for your site.</p>
<p>First, you need to setup Cloudlfare and make it your DNS provider.</p>
<p>Sign up for a <a href="https://cloudflare.com">Cloudflare acccount</a>. They have a free tier, and everything we’re doing here is covered under that free offering.</p>
<p>Enter your site url as the name.</p>
<p><img src="/media/static-site-root-domain/cloudflare-new-site.png" alt="cloudflare new site screen"></p>
<p>Select the Free tier. I put a few extra arrows so you know for sure which one it is.</p>
<p><img src="/media/static-site-root-domain/free-account.png" alt="cloudflare tier selection screen"></p>
<p>Since Cloudflare is going to be your new DNS provider, it tries to query your site to see if it can determine what your current DNS records are. This is so you don’t have to copy them all over manually from whatever you current DNS provider is. Click the “continue” button at the bottom of this screen.</p>
<p><img src="/media/static-site-root-domain/cloudflare-continue.png" alt="cloudflare DNS preview screen"></p>
<p>Now Cloudflare is going to give you two new nameservers that it wants you to use instead of your current nameservers. This requires logging in to your DNS provider and changing the nameserver. Every provider is different (like snowflakes and Nickelback songs). For this example, we’ll use mine, which is “Namecheap”.</p>
<p>Go to your domain registrar and log in. Go to wherever it is in your dashboard that allows you to manage your domain. There is usually a “Manage” button or option that you need to click on.</p>
<p>From your domain dashboard, find the “nameservers” section. By default, this will be your domain registrars default DNS. You’ll need to change it to custom DNS and enter the nameservers that Cloudflare gave you.</p>
<p><img src="/media/static-site-root-domain/custom-dns.png" alt="cloudflare custom nameserver settings"></p>
<p>Make sure to save your changes. I always make this mistake because the “save” button in Namecheap is so very, very small and not at all like a save button. I mean, is it just me or is this the smallest save button you have ever seen?</p>
<p><img src="/media/static-site-root-domain/tiny-save.png" alt="namecheap tiny save button"></p>
<p>What I’m trying to say is don’t forget to save and “saving” might require you to be a highly trained Army sniper.</p>
<h4 id="configuring-cnames">Configuring CNAMES</h4>
<p>What you’ve just done is said that Cloudflare is now managing your DNS. From here on out, all DNS changes we make will be in Cloudflare.</p>
<p>You’ll need two CNAMEs in Cloudflare DNS. One of them is going to be the “www” which points to the auto-generated domain name that Azure Static Web Apps gives you. The other is going to be a CNAME that points the root domain at the www. This works because Cloudflare supports something called “<a href="https://support.cloudflare.com/hc/en-us/articles/200169056-Understand-and-configure-CNAME-Flattening">CNAME flattening</a>”. Simply put, it’s going to “flatten” any request to mystaticsite.com over to <a href="http://www.mystaticsite.com">www.mystaticsite.com</a>.</p>
<p><img src="/media/static-site-root-domain/two-cnames.png" alt="cloudflare dns dashboard showing two custom CNAME&rsquo;s"></p>
<p><strong>IMPORTANT - DON’T SKIP THIS</strong>: Those orange cloud icons on the right-hand side under “proxy status” are important. For the “www” CNAME, we only want Cloudlfare to act as DNS, so <strong>click on the orange cloud</strong> to toggle it to grey (DNS only). For the root domain CNAME, we want to proxy all requests through Cloudflare, so leave that one orange.</p>
<p>At this point, your root domain will work. Kind of. If you navigate to mystaticsite.com (or whatever your domain name is), you will get back the <a href="http://www.mystaticsite.com">www.mystaticsite.com</a> and your site will load. Awesome!</p>
<p><img src="/media/static-site-root-domain/kinda-working.png" alt="site kind of working with cloudflare configuration"></p>
<p>However, if you try and navigate to mystaticsite.com/some/path, the url won’t resolve. That’s because Cloudflare doesn’t recognize the path you just passed in as matching the root CNAME. In order to handle this, we need to setup a page redirect rule.</p>
<p>Click on the “Page Rules” icon in the Cloudflare navigation bar.</p>
<p><img src="/media/static-site-root-domain/page-rules-icon.png" alt="cloudflare page rules icon"></p>
<p>Create a new page rule. Make sure you select the type as “Forwarding URL”. You’ll then need to add in the url you want to match and specify where you want that URL redirected to. The syntax is important. The URL matcher “*” says match yourdomain.com/any/path and redirect it to <a href="http://www.yourdomain.com">www.yourdomain.com</a>. The $1 appends anything after the .com to the redirect. So if you went to yourdomain.com/any/path you will get redirected to <a href="http://www.yourdomain.com/any/path">www.yourdomain.com/any/path</a>.</p>
<p><img src="/media/static-site-root-domain/page-rules-screen.png" alt="cloudflare page rules configuration screen"></p>
<p>And now - you can select any path you like on your root domain and you will get back the right page in your app.</p>
<h2 id="when-will-root-domains-be-officially-supported">When will root domains be officially supported?</h2>
<p>Hopefully sooner than later. Rest easy knowing that the team is keenly aware that root domain support is an essential feature. The change required to support it is bigger than just Static Web Apps, and there is already a plan in place to make that change. It’s a priority for the service, so no need to worry that it will stay like this forever.</p>
<h2 id="more-azure-static-apps-resources">More Azure Static Apps Resources</h2>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/static-web-apps/?WT.mc_id=staticwebapps-docs-cxa">Static Web Apps Docs</a></li>
<li><a href="https://docs.microsoft.com/en-us/learn/modules/publish-app-service-static-web-app-api/?WT.mc_id=staticwebapps-frameworks-cxa">Create and publishing an Angular, React, Svelte or Vue JavaScript app and API</a></li>
<li><a href="https://docs.microsoft.com/en-us/learn/modules/create-deploy-static-webapp-gatsby-app-service/?WT.mc_id=staticwebapps-sitegen-cxa">Creating and publishing an app with Gatsby</a></li>
<li><a href="https://github.com/Azure/static-web-apps">Give us your feedback!</a></li>
</ul>
</div>
  
</article></main>
<footer class="footer">
  <span>&copy; 2021 <a href="http://burkeholland.github.io/">Burke Knows Words</a></span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</span>
  <span>&middot;</span>
  <span>Theme️ <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper</a></span>
</footer>
<script src="http://burkeholland.github.io/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
</body>
</html>

