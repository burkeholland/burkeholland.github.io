<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>Trimming expenses on The Urlist with Azure Cosmos DB Free Tier - Burke Knows Words</title>
    
    <meta name="description" content="Summary: We migrated theurlist.com to the new Cosmos DB Free Tier and shaved ~35$ per month off of our Azure bill. Cosmos DB Free Tier gives you 400 RU/s for free every month. This should be more than enough for most small projects. 
Get Azure Cosmos DB Free Tier 
 
theurlist.com is a project that I wrote with my colleague Cecil Phillip last year. We wanted to see if we could build a site on Azure that was two things…">
    <meta name="author" content="">
    
    <link href="http://burkeholland.dev/an-old-hope.min.css" rel="stylesheet">
    <link href="http://burkeholland.dev/style.css" rel="stylesheet">
    <link href="http://burkeholland.dev/custom.css" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="http://burkeholland.dev/apple-touch-icon.png">
    <link rel="icon" href="http://burkeholland.dev/favicon.ico">
    <meta name="generator" content="Hugo 0.80.0" />
    
    
    
    <script>
      function setTheme() {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.body.classList.add('dark');
          return;
        }

        const time = new Date();
        const prev = localStorage.getItem('date');
        const date = String(time.getMonth() + 1) + '.' + String(time.getDate());

        const now = time.getTime();
        let sunrise;
        let sunset;

        function setBodyClass() {
          if (now > sunrise && now < sunset) return;
          document.body.classList.add('dark');
        }

        if (date !== prev) {
          fetch('https://api.ipgeolocation.io/astronomy?apiKey=5ed37d85103e4defa5df4c5298ed5215')
            .then((res) => res.json())
            .then((data) => {
              sunrise = data.sunrise.split(':').map(Number);
              sunset = data.sunset.split(':').map(Number);
            })
            .catch(() => {
              sunrise = [7, 0];
              sunset = [19, 0];
            })
            .finally(() => {
              sunrise = time.setHours(sunrise[0], sunrise[1], 0);
              sunset = time.setHours(sunset[0], sunset[1], 0);
              setBodyClass();
              localStorage.setItem('sunrise', sunrise);
              localStorage.setItem('sunset', sunset);
            });
          localStorage.setItem('date', date);
        } else {
          sunrise = Number(localStorage.getItem('sunrise'));
          sunset = Number(localStorage.getItem('sunset'));
          setBodyClass();
        }
      }
    </script>
  </head>
  <body class="single">
    <script>
      setTheme();
    </script>
    <header class="header">
      <nav class="nav">
        <p class="logo"><a href="http://burkeholland.dev/">Burke Knows Words</a></p>
      </nav>
    </header>
    <main class="main">


<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">Trimming expenses on The Urlist with Azure Cosmos DB Free Tier</h1>
    <div class="post-meta">March 17, 2020</div>
  </header>
  <div class="post-content"><summary>
Summary: We migrated <a href="https://www.theurlist.com">theurlist.com</a> to the new Cosmos DB Free Tier and shaved ~35$ per month off of our Azure bill. Cosmos DB Free Tier gives you 400 RU/s for free every month. This should be more than enough for most small projects.
<p></p>
<div class="cta-container"><a class="cta" href="https://devblogs.microsoft.com/cosmosdb/build-apps-for-free-with-azure-cosmos-db-free-tier/?WT.mc_id=personal-blog-buhollan">Get Azure Cosmos DB Free Tier</a></div>
<p></p>
</summary>
<p></p>
<p><a href="https://www.theurlist.com">theurlist.com</a> is a project that I wrote with my colleague <a href="https://twitter.com/cecilphillip">Cecil Phillip</a> last year. We wanted to see if we could build a site on Azure that was two things…</p>
<ol>
<li>Serverless</li>
<li>Cheap</li>
</ol>
<p>Now you would think that “cheap” would go hand-in-hand with “Serverless”, and that’s true. But there are portions of theurlist.com that are not strictly “Serverless” by definition because those pieces didn’t exist in Azure at the time. One of those is our database - Azure Cosmos DB.</p>
<p>Azure Cosmos DB is the NoSQL data store that backs everything that theurlist.com does. Cosmos DB does not yet allow you to pay by request, or only for what you use. You need to buy something called “Request Units per Second” up front in batches. The lowest amount you can buy is 400, and that costs ~24$ per month.</p>
<p>The database for theurlist.com is dead simple. It’s one database with one collection.</p>
<p><img src="/media/linkylinkdb.png" alt="Cosmos DB instance in Data Explorer"></p>
<blockquote>
<p>The database is called “linkylinkdb”. The original working name for this project was “Linky Link”. Although <a href="http://linkylink.com/">linkylink.com</a> was already registered and is the home page of a dog named “Lincoln” where you can see a slide show of him in various poses. It’s probably a better use of the URL if we’re being honest.</p>
</blockquote>
<p>Monthly traffic to theurlist.com is around 60K visits. This equates to around 2 ru/s in Cosmos DB. TWO. We are currently paying for 400. That’s 200 times more throughput than we need and we’re paying for it. And sometimes we don’t even use that. In fact, in the last 7 days, we haven’t even averaged 1.</p>
<p><img src="/media/cosmos-db-rus.png" alt="The average number of Cosmos DB RU/s displayed in Azure portal"></p>
<p>Our 400 RU cost each month, combined with with us occasionally upping the RU/s to do load testing demos tipped our total Cosmos DB bill to around 32$ per month.</p>
<p><img src="/media/cosmos-db-old-cost.png" alt="Cosmos DB cost summary"></p>
<p>Most of that we simply aren’t using, but we have to pay for it anyway. Which, doesn’t feel great. In our endless persuit of running a cost-effective app on Azure, we were excited to learn about the launch of the new Cosmos DB Free Tier.</p>
<h2 id="migrating-to-the-cosmos-db-free-tier">Migrating to the Cosmos DB Free Tier</h2>
<p>Cosmos DB has officially launched a <a href="https://devblogs.microsoft.com/cosmosdb/build-apps-for-free-with-azure-cosmos-db-free-tier/?WT.mc_id=personal-blog-buhollan">free tier</a>. But what exactly does that mean?</p>
<p>Free Tier allows you to have one Cosmos DB account where you apply a “Free Tier” discount. This gives you the first 400 RU/s free every month. They are deducted from the bill. For theurlist.com, this is perfect. We aren’t anywhere <em>near</em> 400 RU/s. And based on my calculations, if 60K views equates to 2 RU/s, we could go up to 12 MILLION requests per month before we get to 400 RU/s. That’s a LOT of traffic.</p>
<p>Last week, we migrated our database to the Cosmos DB free tier. We filmed the whole thing so you can see how to move your Cosmos DB database if you’ve got a small project like we do. There are two options you can use in terms of tools to do this.</p>
<ol>
<li><a href="https://ms-adf.azure.com?WT.mc_id=personal-blog-buhollan">Azure Data Factory</a></li>
<li><a href="https://ms-adf.azure.com?WT.mc_id=personal-blog-buhollan">Cosmos DB Migration Tool</a></li>
</ol>
<p>The Cosmos DB Migration tool is Windows only, so we opted for the Azure Data Factory, which is browser-based.</p>
<p>The downside of the Azure Data Factory is that we had to create the database and collection before we could migrate the data. If you have a lot of databases or collections, and or you have lots of triggers and stored procedures, you’re better off using the Cosmos DB Migration Tool.</p>
<p>We decided to record the process in case you are looking to migrate your own Cosmos DB database to the Free Tier. Enjoy!</p>
<div style="text-align: center;"><iframe width="720" height="405" src="https://www.youtube.com/embed/kEuEvPtgaK0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
  
</article></main>
<footer class="footer">
  <span>&copy; 2021 <a href="http://burkeholland.dev/">Burke Knows Words</a></span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</span>
  <span>&middot;</span>
  <span>Theme️ <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper</a></span>
</footer>
<script src="http://burkeholland.dev/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
</body>
</html>

